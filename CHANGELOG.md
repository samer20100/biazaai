# سجل التحديثات - BiazaAI

هذا الملف يوثق التحديثات الرئيسية التي تم إجراؤها على النظام الأساسي.

## التحديثات الأخيرة (يناير 2026)

### 1. قسم حفظ المحادثات المنفصلة لكل شخص
- **الوصف**: تم إضافة نظام حفظ المحادثات في `localStorage` بدلاً من قاعدة البيانات المركزية، مما يضمن خصوصية كل مستخدم وعدم مشاركة المحادثات.
- **التغييرات**:
  - إضافة وظائف `getLocalChats`، `saveLocalChat`، `deleteLocalChat` في `services/apiService.ts`.
  - تعديل `App.tsx` لاستخدام التخزين المحلي بدلاً من الخادم.
  - تحديث `Sidebar.tsx` لعرض المحادثات المحفوظة محلياً.
  - كل محادثة تحمل معرفًا فريدًا وتاريخ إنشاء وتحديث.
- **الفائدة**: سرعة الوصول، استقلالية المستخدم، عدم اعتماد على اتصال الشبكة.

### 2. إزالة قسم الاشتراك المنفصل وإضافة زر بوابة الدفع في المحادثة
- **الوصف**: بناءً على طلب المستخدم، تم إزالة صفحة الاشتراك المنفصلة (`SubscriptionView`) وتحويل بوابة الدفع إلى زر مباشر في واجهة المحادثة.
- **التغييرات**:
  - حذف مكون `SubscriptionView.tsx`.
  - إزالة `View.SUBSCRIPTION` من enum `View` في `types.ts`.
  - إزالة الاستيراد والإشارات إلى `SubscriptionView` في `App.tsx`.
  - إزالة زر "Biaza Pro" من الشريط الجانبي (`Sidebar.tsx`).
  - إضافة زر "اشترك الآن" في رأس `ChatView.tsx` يفتح رابط Stripe الاختباري مباشرةً.
  - تحديث `README.md` و `CHANGELOG.md` لتعكس التغييرات.
- **الفائدة**: تبسيط واجهة المستخدم، جعل عملية الدفع سريعة ومباشرة دون الحاجة إلى التنقل إلى صفحة منفصلة.

### 3. دمج زر الترقية مع بوابة الدفع
- **الوصف**: بناءً على طلب المستخدم، تم إزالة زر "اشترك الآن" المنفصل وجعل زر "الترقية" يفتح بوابة الدفع مباشرةً.
- **التغييرات**:
  - تعديل `ChatView.tsx` ليكون زر واحد فقط "الترقية الآن مقابل 20$/شهر" يفتح رابط Stripe.
  - تعديل `App.tsx` لجعل `onOpenUpgrade` يفتح رابط Stripe بدلاً من تغيير العرض إلى `View.UPGRADE`.
  - إزالة مكون `UpgradeView.tsx` وإزالة `View.UPGRADE` من enum `View`.
  - تحديث `CHANGELOG.md` لتعكس التغييرات.
- **الفائدة**: واجهة أكثر نظافة، زر واحد واضح للترقية يوجه المستخدم مباشرة إلى بوابة الدفع.

### 4. إنشاء لوحة تحكم إدارية متكاملة وآمنة
- **الوصف**: بناء لوحة تحكم إدارية متكاملة حصرياً للمشرفين مع نظام مصادقة آمن، إدارة مفاتيح API، إحصائيات حية، ومعاملات دفع.
- **التغييرات**:
  - إضافة enum `View.ADMIN`, `View.ADMIN_LOGIN`, `View.DONATION` في `types.ts`.
  - إنشاء مكون `AdminLoginView.tsx` لتسجيل دخول المشرفين مع مصادقة عبر الخادم.
  - إنشاء مكون `AdminView.tsx` مع أربعة تبويبات (Dashboard, API Keys, Users, Transactions).
  - إضافة نظام مصادقة على الخادم (`/api/admin/login`, middleware `authenticateAdmin`).
  - إنشاء جدول `transactions` في قاعدة البيانات لتسجيل معاملات الدفع.
  - إضافة صفحة تبرع مخصصة (`DonationView.tsx`) مع بوابة دفع مخصصة (yadfe‑yad sandbox).
  - تحديث `apiService.ts` بدوال `adminLogin`, `sendTransaction`, `getTransactions`.
  - تحديث `App.tsx` لدعم المشاهد الجديدة وإدارة token المشرف.
  - تأمين الاتصالات عبر token في رؤوس HTTP وتشفير تخزين البيانات الحساسة.
- **الفائدة**: إدارة مركزية للنظام، مراقبة المعاملات، أمان عالٍ، بوابة دفع مخصصة.

### 5. تحديثات لوحة التحكم الإدارية (الوصول الآمن)
- **الوصف**: بناءً على طلب المستخدم، تم تحديث واجهة الإعدادات (`SettingsView.tsx`) لإضافة قسم "الإدارة" مع زر "لوحة التحكم الإدارية" للمشرفين فقط.
- **التغييرات**:
  - إضافة دالة `handleAdminDashboard` في `SettingsView.tsx` للتحقق من وجود `admin_token` وتوجيه المستخدم إلى `View.ADMIN` أو `View.ADMIN_LOGIN`.
  - تحديث `App.tsx` لتمرير `onNavigate` إلى `SettingsView`.
  - تحديث `AdminLoginView.tsx` و `AdminView.tsx` لضمان عمل أزرار "العودة" بشكل صحيح.
  - تحديث `README.md` بإضافة قسم كامل عن لوحة التحكم الإدارية وطريقة الوصول.
- **الفائدة**: وصول آمن وسهل للمشرفين إلى لوحة التحكم الإدارية من داخل تطبيق المستخدم، مع حماية المنطقة بحيث لا يصل إليها إلا من لديه صلاحيات.

### 6. تحديثات الاشتراك والباقة الجديدة
- **الوصف**: بناءً على طلب المستخدم، تم إجراء التعديلات التالية:
  1. **تغيير بيانات دخول المشرفين** إلى `samerzzzxxx2010` (يوزر وباسورد) في `server/index.js`.
  2. **إزالة قسم "لوحة التحكم الإدارية"** من واجهة الإعدادات (`SettingsView.tsx`) لجعل الوصول إليها عبر رابط مخصص فقط.
  3. **تحويل صفحة التبرع (`DonationView.tsx`)** إلى صفحة اشتراك **Biaza Pro** بسعر 25 دولار لمدة 3 أشهر مع الميزات التالية:
     - دعم فني مخصص
     - استخدام غير محدود
     - استخدام WhatsApp Business بشكل غير محدود
     - استخدام Telegram Bot بشكل غير محدود
  4. **إزالة قسم التبرعات** بالكامل واستبداله بباقة اشتراك واضحة.
  5. **تحديث زر الترقية** في `ChatView.tsx` لفتح صفحة الاشتراك مباشرة.
- **الفائدة**: تحسين تجربة المستخدم، تقديم باقة اشتراك واضحة القيمة، إزالة التبرعات غير المرغوبة، تأمين لوحة التحكم الإدارية برابط مخصص.

### 6. ميزات سابقة تم تنفيذها (مراجعة)
- **أتمتة WhatsApp Business**: ربط حساب WhatsApp مع النظام، توليد رمز QR حقيقي، ردود ذكية مخصصة.
- **أتمتة Telegram**: تكامل Telegram عبر الهاتف الأساسي (بدون بوتات)، معالجة الرسائل تلقائياً.
- **ذاكرة المحادثات لكل عميل**: حفظ تاريخ المحادثة لكل رقم هاتف في قاعدة البيانات (`messages`)، استخدام السياق في توليد الردود.
- **لوحة التحكم المتقدمة**: إحصائيات لحظية، محادثات حديثة، طلبات مكتملة، تأكيد الطلبات.
- **نظام تخصيص متقدم**: حقول الاسم، الدور، نوع المشروع، الأسعار، التعليمات، نبرة الرد، حجم الرد، ساعات العمل، أيام العمل، حسابات التواصل، اللغة، اللهجة.
- **إخفاء أدوات المطور**: سكريبت لمنع فحص أدوات المطور في المتصفح.
- **حفظ حالة الجلسة**: استخدام `localStorage` لحفظ `sessionId` وحالة اتصال WhatsApp.
- **نظام حفظ المحادثات الذكية**: حفظ محادثات الذكاء الاصطناعي في قاعدة البيانات (`ai_chats`) مع دعم `currentChatId` لمنع التكرار.

## الهيكل التقني الحالي
- **الواجهة الأمامية**: React (TypeScript) + Vite، مكونات وظيفية، توجيه بين العروض.
- **الخادم الخلفي**: Node.js + Express + Socket.io + SQLite.
- **قاعدة البيانات**: SQLite مع جداول `automation_sessions`, `messages`, `ai_chats`, `completed_requests`, إلخ.
- **خدمات الذكاء الاصطناعي**: DeepSeek Chat API (بديل Gemini).
- **أتمتة المراسلة**: WhatsApp Web.js، Telegram MTProto.
- **التخزين المحلي**: `localStorage` للمحادثات وحالة المستخدم.

## الخطوات التالية المقترحة
- إضافة webhooks لـ Stripe للتحقق التلقائي من الدفع.
- تحسين واجهة إدارة الاشتراكات (تاريخ الاشتراك، تجديد، إلغاء).
- إضافة نظام إشعارات داخل التطبيق.
- تحسين أداء استعلامات قاعدة البيانات.
- إضافة تصدير المحادثات (PDF، نص).

---

*آخر تحديث: يناير 2026*